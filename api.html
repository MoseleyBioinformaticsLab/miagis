<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>API &mdash; MIAGIS 1.0.0 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="License" href="license.html" />
    <link rel="prev" title="JSON Schema" href="jsonschema.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MIAGIS
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsonschema.html">JSON Schema</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">TODO List</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MIAGIS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="module-src.miagis">
<span id="api"></span><h1>API<a class="headerlink" href="#module-src.miagis" title="Permalink to this headline">¶</a></h1>
<p>This package has the following modules:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">build</span></code></dt><dd><p>This module contains functions for building the metadata file.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">miagis_schema</span></code></dt><dd><p>This module contains the schema for validating user input.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">validate</span></code></dt><dd><p>This module contains functions to validate the metadata file.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">user_input_checking</span></code></dt><dd><p>This module contains functions to validate user input.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">print_map_layers</span></code></dt><dd><p>This module contains the code to run the print_map_layers command.</p>
</dd>
</dl>
<span class="target" id="module-src.miagis.user_input_checking"></span><p>This module contains the functions used to read in and validate various inputs.</p>
<dl class="function">
<dt id="src.miagis.user_input_checking.additional_args_checks">
<code class="sig-prename descclassname">src.miagis.user_input_checking.</code><code class="sig-name descname">additional_args_checks</code><span class="sig-paren">(</span><em class="sig-param">args: dict</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/miagis/user_input_checking.html#additional_args_checks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.miagis.user_input_checking.additional_args_checks" title="Permalink to this definition">¶</a></dt>
<dd><p>Run some checks on args that jsonschema can’t do.</p>
<p>This assumes that args has been validated with a JSON schema and does some
further checking to make sure the values entered by the user make sense.
Prints a message and exits the program if problems are found.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>args</strong> – the arguments entered into the program by the user.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.miagis.user_input_checking.additional_json_schemas_checks">
<code class="sig-prename descclassname">src.miagis.user_input_checking.</code><code class="sig-name descname">additional_json_schemas_checks</code><span class="sig-paren">(</span><em class="sig-param">schema_list: list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/miagis/user_input_checking.html#additional_json_schemas_checks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.miagis.user_input_checking.additional_json_schemas_checks" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that all input schemas are valid JSON Schema.</p>
<p>If any schema are not valid JSON Schema then print a message and exit.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>schema_list</strong> – list of dictionaries of properties for JSON schemas.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.miagis.user_input_checking.load_json">
<code class="sig-prename descclassname">src.miagis.user_input_checking.</code><code class="sig-name descname">load_json</code><span class="sig-paren">(</span><em class="sig-param">filepath: str</em><span class="sig-paren">)</span> &#x2192; dict<a class="reference internal" href="_modules/src/miagis/user_input_checking.html#load_json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.miagis.user_input_checking.load_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds error checking around loading a json file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filepath</strong> – filepath to the json file</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>json read from file in a dictionary</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#Exception" title="(in Python v3.10)"><strong>Exception</strong></a> – If file opening has a problem will raise an exception.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.miagis.user_input_checking.read_in_resource_properties">
<code class="sig-prename descclassname">src.miagis.user_input_checking.</code><code class="sig-name descname">read_in_resource_properties</code><span class="sig-paren">(</span><em class="sig-param">resource_properties_path: str</em>, <em class="sig-param">exact_matching: bool</em><span class="sig-paren">)</span> &#x2192; Tuple[dict, dict]<a class="reference internal" href="_modules/src/miagis/user_input_checking.html#read_in_resource_properties"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.miagis.user_input_checking.read_in_resource_properties" title="Permalink to this definition">¶</a></dt>
<dd><p>Read in resource_properties and put it in expected dict form.</p>
<p>resource_properties can be csv, xlsx, or JSON, so if it is one of the tabular
forms some of the fields have to be read in special.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resource_properties_path</strong> – filepath to the resource_properties file.</p></li>
<li><p><strong>exact_matching</strong> – if True resource names will not be modified.
if False resource names are stripped, lowered, and spaces replaced with underscores.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The final dictionary of resource_properties, and a mapping of the original resource name and new name.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.miagis.user_input_checking.validate_arbitrary_schema">
<code class="sig-prename descclassname">src.miagis.user_input_checking.</code><code class="sig-name descname">validate_arbitrary_schema</code><span class="sig-paren">(</span><em class="sig-param">dict_to_validate: dict</em>, <em class="sig-param">schema: dict</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/miagis/user_input_checking.html#validate_arbitrary_schema"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.miagis.user_input_checking.validate_arbitrary_schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate any arbitrary JSON Schema.</p>
<p>Wraps around jsonschema.validate() to give more human readable errors
for most validation errors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_to_validate</strong> – instance to validate.</p></li>
<li><p><strong>schema</strong> – JSON Schema to validate the instance with.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>jsonschema.ValidationError</strong> – any validation errors that aren’t handled reraise the original.</p>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-src.miagis.build"></span><p>This module contains the code to build the metadata file.</p>
<dl class="function">
<dt id="src.miagis.build.build">
<code class="sig-prename descclassname">src.miagis.build.</code><code class="sig-name descname">build</code><span class="sig-paren">(</span><em class="sig-param">resource_properties_path: str</em>, <em class="sig-param">exact_matching: bool = False</em>, <em class="sig-param">remove_optional_fields: bool = True</em>, <em class="sig-param">add_resources: bool = True</em>, <em class="sig-param">overwrite_format: bool = False</em>, <em class="sig-param">overwrite_fairness: bool = False</em>, <em class="sig-param">base_metadata: dict = {}</em>, <em class="sig-param">entry_version: int = 1</em>, <em class="sig-param">entry_id: str = ''</em>, <em class="sig-param">base_description: str = ''</em>, <em class="sig-param">products: list = []</em>, <em class="sig-param">schema_list: list = []</em><span class="sig-paren">)</span> &#x2192; dict<a class="reference internal" href="_modules/src/miagis/build.html#build"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.miagis.build.build" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a metadata file from the input settings in the current directory.</p>
<p>Loop over files in the folders of the current directory, ignoring files in
the top level of the current directory, and fill in what information can be
about the file in the metadata. If resource_properties are provided then resources
are matched to those in resource_properties and more information is able to be
automatically put into the metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resource_properties_path</strong> – filepath to a file containing file properties.</p></li>
<li><p><strong>exact_matching</strong> – if True file names are matched exactly. if False names are modified and matched fuzzy.</p></li>
<li><p><strong>remove_optional_fields</strong> – if True optional metadata fields that are empty or null are removed.</p></li>
<li><p><strong>add_resources</strong> – if True add resources that aren’t in the metadata after looping over the files to the metadata.</p></li>
<li><p><strong>overwrite_format</strong> – if True overwrite the default format determined from the file extension for files with what is in resource_properties.</p></li>
<li><p><strong>overwrite_fairness</strong> – if True overwrite the default value of “FAIR” for files with what is in resource_properties.</p></li>
<li><p><strong>base_metadata</strong> – update the metadata dict with this input dict.</p></li>
<li><p><strong>entry_version</strong> – version number of the metadata.</p></li>
<li><p><strong>entry_id</strong> – unique id for the metadata.</p></li>
<li><p><strong>base_description</strong> – description of the metadata.</p></li>
<li><p><strong>products</strong> – a list of resource ids.</p></li>
<li><p><strong>schema_list</strong> – a list of dicitonaries with information about how to detect if a JSON file is using that schema, and how to decode that schema to fill in the metadata.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The metadata JSON as a python dict.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.miagis.build.determine_json_fields">
<code class="sig-prename descclassname">src.miagis.build.</code><code class="sig-name descname">determine_json_fields</code><span class="sig-paren">(</span><em class="sig-param">schema_list: list</em>, <em class="sig-param">input_json: dict</em>, <em class="sig-param">file_path: str</em><span class="sig-paren">)</span> &#x2192; Tuple[dict, Union[dict, str]]<a class="reference internal" href="_modules/src/miagis/build.html#determine_json_fields"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.miagis.build.determine_json_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine the types of the feature properties in the JSON file.</p>
<p>Based on the ESRIJSON and GEOJSON formats there are 2 types of schema styles,
mapping and testing. The mapping style has types already identified with the
properties in the JSON, but the types are not the same as those defined in the
MIAGIS schema, so a mapping between the types is necessary. This style’s dict
entry looks like:</p>
<blockquote>
<div><dl class="simple">
<dt>{“style”:”mapping”, “schema”:valid_jsonschema, “field_path”:path_to_fields,</dt><dd><p>“name_key”:key_to_name, “type_key”:key_to_type, “type_map”:type_mapping}</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>Actual ESRIJSON example:</dt><dd><dl class="simple">
<dt>{“style”:”mapping”, “schema”:miagis_schema.arcgis_schema,</dt><dd><p>“field_path”:’[“layers”][0][“layerDefinition”][“fields”]’,
“name_key”:”name”, “type_key”:”type”, “type_map”:arcgis_type_map}</p>
</dd>
</dl>
</dd>
</dl>
<p>The testing style doesn’t have types listed directly in the JSON so each field’s
type must be tested. This style’s dict entry looks like:</p>
<blockquote>
<div><dl class="simple">
<dt>{“style”:”testing”, “schema”:valid_jsonschema,</dt><dd><p>“features_path”:path_to_features, “properties_key”:key_to_properties}</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>Actual GEOJSON example:</dt><dd><dl class="simple">
<dt>{“style”:”testing”, “schema”:miagis_schema.geojson_feature_schema,</dt><dd><p>“features_path”:””, “properties_key”:”properties”, “schema_URL”:”<a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc7946">https://datatracker.ietf.org/doc/html/rfc7946</a>”}</p>
</dd>
</dl>
</dd>
</dl>
<p>Note that the features_path is assumed to lead to a dict or list, and will
print a warning if does is not.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>schema_list</strong> – list of dictionaries where each dictionary describes a schema to look for and how to determine field types.</p></li>
<li><p><strong>input_json</strong> – the JSON to determine field types for.</p></li>
<li><p><strong>file_path</strong> – path to the JSON file, used for printing error messages.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dictionary of the fields and their types. Ex field_name : {“name”:field_name, “type”:field_type}.
If “schema_URL” is in the schema dictionary then this is returned, otherwise return the jsonschema.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.miagis.build.determine_table_fields">
<code class="sig-prename descclassname">src.miagis.build.</code><code class="sig-name descname">determine_table_fields</code><span class="sig-paren">(</span><em class="sig-param">extension: str</em>, <em class="sig-param">path_to_read_file: pathlib.Path</em><span class="sig-paren">)</span> &#x2192; dict<a class="reference internal" href="_modules/src/miagis/build.html#determine_table_fields"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.miagis.build.determine_table_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Read in the tabular file and determine the names and types of the columns.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>extension</strong> – the extension of the file without the period, used to read in the file correctly.</p></li>
<li><p><strong>path_to_read_file</strong> – filepath to read in the file from.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Keys are the field name or column number and values are the name, type, and column number for each field. Ex: field_name : {“name”:field_name, “type”:field_type, “identifier”:column_number+1, “identifier%type”:”column”}.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.miagis.build.find_resource_properties">
<code class="sig-prename descclassname">src.miagis.build.</code><code class="sig-name descname">find_resource_properties</code><span class="sig-paren">(</span><em class="sig-param">resource_properties: dict</em>, <em class="sig-param">resource_properties_keys: list</em>, <em class="sig-param">exact_matching: bool</em>, <em class="sig-param">filename_minus_extension: str</em>, <em class="sig-param">relative_location: str</em><span class="sig-paren">)</span> &#x2192; Tuple[dict, list, str]<a class="reference internal" href="_modules/src/miagis/build.html#find_resource_properties"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.miagis.build.find_resource_properties" title="Permalink to this definition">¶</a></dt>
<dd><p>Match filename to an entry in resource_properties and pull out properties.</p>
<p>The point of this function is to find the match in resource_properties and format
all of the information so it can be easily added to metadata without more logic
after returning from this function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resource_properties</strong> – dictionary where the keys are filenames and values are properties of the file to go in the metadata.</p></li>
<li><p><strong>resource_properties_keys</strong> – list of the resource_properties_keys, it is given as an input so the list isn’t created every time the function runs.</p></li>
<li><p><strong>exact_matching</strong> – if True filename is matched as is, if False the filename is stripped, lowered, and spaces replaced with underscores before matching</p></li>
<li><p><strong>filename_mins_extension</strong> – the filename to match with the extension removed.</p></li>
<li><p><strong>relative_location</strong> – location of the file relative to the current directory, input here so it can be added to alternate_locations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The properties of the matched filename from resource_properties.
If alternate_locations is in resource_properties return it, else return an empty list, but always add the relative_location to the list.
The resource_name in resource_properties that was matched to filename_minus_extension.</p>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-src.miagis.validate"></span><p>This module contains the code to validate the metadata file.</p>
<dl class="function">
<dt id="src.miagis.validate.validate">
<code class="sig-prename descclassname">src.miagis.validate.</code><code class="sig-name descname">validate</code><span class="sig-paren">(</span><em class="sig-param">metadata: dict</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/miagis/validate.html#validate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.miagis.validate.validate" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate input metadata against the MIAGIS schema.</p>
<p>Use jsonschema to validate input metadata, and then do some additional checking
that jsonschema alone cannot, such as checking that all layers for each map
exist in the layers section.</p>
<p>The specific JSON schema used is the metadata_schema in the miagis_schema module.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>metadata</strong> – input dictionary of metadata.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>jsonschema.ValidationError</strong> – any validation errors that aren’t handled reraise the original.</p>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-src.miagis.print_map_layers"></span><p>This module contains the code to print and save map structure.</p>
<dl class="function">
<dt id="src.miagis.print_map_layers.print_map_layers">
<code class="sig-prename descclassname">src.miagis.print_map_layers.</code><code class="sig-name descname">print_map_layers</code><span class="sig-paren">(</span><em class="sig-param">metadata: dict</em>, <em class="sig-param">save_path: str = ''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/miagis/print_map_layers.html#print_map_layers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.miagis.print_map_layers.print_map_layers" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the maps and layers in metadata and pretty print them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metadata</strong> – A valid metadata to find maps in.</p></li>
<li><p><strong>save_path</strong> – path to save the output to a file, doesn’t save if it is an empty string.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="jsonschema.html" class="btn btn-neutral float-left" title="JSON Schema" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="license.html" class="btn btn-neutral float-right" title="License" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Travis Thompson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>